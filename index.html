<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walkie-Talkie WebRTC</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        input, button {
            font-size: 18px;
            padding: 10px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Walkie-Talkie WebRTC</h1>
    <label>Masukkan Nomor Radio (00.00 - 99.99):</label>
    <input type="text" id="radioNumber" placeholder="Contoh: 12.34" pattern="\d{2}\.\d{2}">
    <button onclick="joinChannel()">Gabung</button>
    <br><br>
    <button id="talkButton" disabled>Tekan untuk Bicara</button>
    <button onclick="leaveCall()">Keluar</button>
    <audio id="remoteAudio" autoplay></audio>

    <script>
        let peerConnection;
        let localStream;
        let radioID;

        // Ganti dengan server signaling WebSocket atau Firebase
        const signalingServer = new WebSocket("wss://your-signaling-server.com");

        async function joinChannel() {
            radioID = document.getElementById("radioNumber").value;
            if (!/^\d{2}\.\d{2}$/.test(radioID)) {
                alert("Nomor radio harus dalam format 00.00 - 99.99!");
                return;
            }

            localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            peerConnection = new RTCPeerConnection();
            localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

            peerConnection.ontrack = (event) => {
                document.getElementById("remoteAudio").srcObject = event.streams[0];
            };

            signalingServer.send(JSON.stringify({ type: "join", id: radioID }));

            document.getElementById("talkButton").disabled = false;
        }

        document.getElementById("talkButton").addEventListener("mousedown", () => {
            localStream.getAudioTracks()[0].enabled = true;
        });

        document.getElementById("talkButton").addEventListener("mouseup", () => {
            localStream.getAudioTracks()[0].enabled = false;
        });

        function leaveCall() {
            if (peerConnection) {
                peerConnection.close();
            }
            document.getElementById("talkButton").disabled = true;
        }
    </script>
</body>
</html>
